<!DOCTYPE html>
<html>

<head>
    <title>Enmodal</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link rel="stylesheet" href="static/css/style.css" />
    <link rel="stylesheet" href="static/css/enmodal.css" />
    <link rel="stylesheet" href="static/css/sidebar.css" />
    <link rel="stylesheet" href="static/css/modal.css" />
    <link rel="stylesheet" href="static/css/animate.css" />
    <link rel="stylesheet" href="static/css/balloon.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css" />
    <link rel="stylesheet" href="static/css/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"/>

    <script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.vectorgrid@1.2.0"></script>
    <script src="https://unpkg.com/esri-leaflet@2.1.1/dist/esri-leaflet.js"
    integrity="sha512-ECQqaYZke9cSdqlFG08zSkudgrdF6I1d8ViSa7I3VIszJyVqw4ng1G8sehEXlumdMnFYfzY0tMgdQa4WCs9IUw=="
    crossorigin=""></script>
    <script src="static/js/navbar-handlers.js"></script>
</head>

<body class="enm">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/leaflet.esri.geocoder/2.0.2/esri-leaflet-geocoder.css">
    <script src="https://cdn.jsdelivr.net/leaflet.esri.geocoder/2.0.2/esri-leaflet-geocoder.js"></script>

    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />

    <script src="static/js/spectrum.min.js"></script>
    <link rel="stylesheet" href="static/css/spectrum.css" />

    <script src="static/js/leaflet.curve.min.js"></script>
    <script src='static/js/leaflet.pip.min.js'></script>
    <script src='static/js/leaflet.image.min.js'></script>
    <script src='static/js/leaflet.polylineoffset.min.js'></script>
    <script src='static/js/turf.min.js'></script>
    <script src='static/js/spline.min.js'></script>
    <script src='static/js/bezier.min.js'></script>
    <script src="static/js/chroma.min.js"></script>
    <script src="static/js/svg.min.js"></script>
    <script src="static/js/filesaver.min.js"></script>
    <script type="text/javascript" src="http://canvg.github.io/canvg/rgbcolor.js"></script> 
    <script type="text/javascript" src="http://canvg.github.io/canvg/StackBlur.js"></script>
    <script type="text/javascript" src="http://canvg.github.io/canvg/canvg.js"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.min.js"></script>
    <!--
    <script src='static/js/enmodal/settings.js'></script>
    <script src='static/js/enmodal/transit.js'></script>
    <script src='static/js/enmodal/draw.js'></script>
    <script src='static/js/enmodal/interface.js'></script>
    <script src='static/js/enmodal/utils.js'></script>
    <script src='static/js/TransitTest.js'></script>

    <script src='static/js/enmodal/session.js'></script>
    <script src='static/js/enmodal/sidebar.js'></script>
    <script src='static/js/enmodal/sharing.js'></script>
    <script src='static/js/enmodal/station-pair.js'></script>
    <script src='static/js/enmodal/bezier.js'></script>
    <script src='static/js/enmodal/markers.js'></script>
    <script src='static/js/enmodal/data-layers.js'></script>
    -->
    
    
    <script src="static/js/bootstrap.min.js"></script>
    <script src='static/js/lz-string.min.js'></script>
    <script src="static/js/clipboard.min.js"></script>


    <!-- vue.js templates -->
    <template id="template-modal-city-picker">
        <div class="enm modal">
            <div class="enm modal-middle">
                <div class="enm modal-inner">
                    <div class="enm modal-row">
                        <input id="city-picker-input" class="large picker" type="text" placeholder="New York City" autocomplete="off" />
                        <a class="button large picker" @click="$emit('close')">Start</a>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="template-modal-sharing">
        <div class="enm modal">
            <div class="enm modal-middle">
                <div class="enm modal-inner">
                    <div class="enm modal-col">
                        <div class="header">Sharing<a class="button" @click="$emit('close')">close</a></div>
                        <div class="body">
                            <div>
                                <p>Public link</p>
                                <div class="share-link-content" id="share-link-public">
                                    <div class="share-link-input">
                                        <input type="text" id="share-link-public-input" readonly>
                                    </div>
                                    <a class="share-link-copy-button button" data-clipboard-target="#share-link-public-input">copy</a>
                                </div>
                                <p>This link is a read-only copy of your map that can be shared publicly.</p>
                            </div>
                            <div>
                                <p>Private link</p>
                                <div class="share-link-content" id="share-link-private">
                                    <div class="share-link-input">
                                        <input type="text" id="share-link-private-input" readonly>
                                    </div>
                                    <a class="share-link-copy-button button" data-clipboard-target="#share-link-private-input">copy</a>
                                </div>
                                <p>This link allows you to edit your map later. Bookmark it and keep it secret!</p>
                            </div>
                            <div>
                                <strong>Don't forget to save your map before sharing!</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="template-modal-pro-gate">
        <div class="enm modal">
            <div class="enm modal-middle">
                <div class="enm modal-inner">
                    <div class="enm modal-col">
                        <div class="header">Beta Test Only<a class="button" @click="$emit('close')">close</a></div>
                        <div class="body">
                            <p>
                                This feature isn't yet available in the alpha version of enmodal!
                            </p>
                            <p>
                                We are running a closed beta for transit agencies and planning professionals while we work out the bugs before releasing to a general audience. If you're interested in signing up, please <a href="mailto:jason@jpwright.net?subject=interested%20in%20enmodal%20closed%20beta">contact us</a>.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="template-modal-exporting-pdf">
        <div class="enm modal">
            <div class="enm modal-middle">
                <div class="enm modal-inner">
                    <div class="enm modal-col">
                        <div class="header">Exporting PDF...</div>
                        <div class="body">
                            <p style="text-align:center;">
                                <i class="fa fa-3x fa-spinner fa-spin"></i>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="template-modal-session-expired">
        <div class="enm modal">
            <div class="enm modal-middle">
                <div class="enm modal-inner">
                    <div class="enm modal-col">
                        <div class="header">Session Expired</div>
                        <div class="body">
                            <p>Sadly, your session has expired. This could be because you stopped editing your map for a long time, or we had a server interruption that unfortunately impacted your session.</p>
                            <p>To continue editing, just refresh the page (or wait 5 seconds).</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="template-collapse-caret">
        <a class="button collapse-caret" @click="$emit('collapse')"><i class="fa fa-caret-right" aria-hidden="true"></i></a>
    </template>
    
    <template id="template-modal-gtfs-import">
        <div class="enm modal">
            <div class="enm modal-middle">
                <div class="enm modal-inner">
                    <div class="enm modal-col">
                        <div class="header">GTFS Import<a class="button" @click="$emit('close')">close</a></div>
                        <div class="body">
                            <form enctype="multipart/form-data" novalidate v-if="isInitial || isSaving || isAnalyzing">
                            Choose a .zip file containing valid GTFS data.
                            <div class="dropbox">
                                <input type="file" name="gtfs" :disabled="isSaving || isAnalyzing" @change="filesChange($event.target.name, $event.target.files);" accept=".zip" class="input-file">
                                <p v-if="isInitial">
                                    Drag a .zip file containing GTFS data here to begin, or click to browse.
                                </p>
                                <p v-if="isSaving">
                                    Uploading...
                                </p>
                                <p v-if="isAnalyzing">
                                    Analyzing...
                                </p>
                            </div>
                            </form>
                            <div id="gtfs-upload-contents" v-if="isSuccess">
                                <div>
                                    Choose agencies and routes to import.
                                </div>
                                <div>
                                    <a class="button" v-on:click="selectAll">Select All</a>
                                    <a class="button" v-on:click="selectNone">Select None</a>
                                </div>
                                {% raw %}
                                <div id="gtfs-agency-list">
                                    <form id="gtfs-form">
                                        <div class="gtfs-agency" v-for="service in gtfsImportMap.services">
                                            <b-btn v-b-toggle="'collapse' + service.gtfs_id" variant="primary" class="collapse-caret">
                                                <span class="when-closed"><i class="fa fa-caret-right" aria-hidden="true"></i></span>
                                                <span class="when-opened"><i class="fa fa-caret-down" aria-hidden="true"></i></span>
                                            </b-btn>

                                            <input type="checkbox" class="agency" :data-agency-id="service.gtfs_id" :id="'route' + service.gtfs_id" :name="service.gtfs_id" :value="service.gtfs_id" v-on:click="toggleAgency(service.gtfs_id)"/>
                                            <label :for="'route' + service.gtfs_id">{{ service.name }}</label>
                                            <b-collapse :id="'collapse' + service.gtfs_id" class="mt-2" visible>
                                                <div class="gtfs-routes" :data-agency-id="service.gtfs_id">
                                                    <div class="gtfs-route" v-for="line in service.lines">
                                                        <input type="checkbox" class="route" :data-agency-id="service.gtfs_id" :data-route-id="line.gtfs_id" :id="line.gtfs_id" :name="line.gtfs_id" :value="line.gtfs_id" />
                                                        <label :for="line.gtfs_id">
                                                            <div class="subway-line-long" v-bind:style="{ 'color': line.color_fg, 'background-color': line.color_bg }">
                                                                <div class="content">
                                                                {{ line.full_name }}
                                                                </div>
                                                            </div>
                                                        </label>
                                                    </div>
                                                </div>
                                            </b-collapse>
                                        </div>
                                    </form>
                                </div>
                                <div>
                                    <a class="button" v-on:click="start">Import</a>
                                </div>
                                {% endraw %}
                            </div>
                            <div v-if="isImporting">
                                Importing...
                            </div>
                            <div v-if="isFailed">
                                Failed
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="template-modal-json-import">
        <div class="enm modal">
            <div class="enm modal-middle">
                <div class="enm modal-inner">
                    <div class="enm modal-col">
                        <div class="header">JSON Import<a class="button" @click="$emit('close')">close</a></div>
                        <div class="body">
                            <form enctype="multipart/form-data" novalidate v-if="isInitial || isSaving">
                            Choose a .json file created with enmodal.
                            <div class="dropbox">
                                <input type="file" name="json" :disabled="isSaving" @change="filesChange($event.target.name, $event.target.files);" accept=".json" class="input-file">
                                <p v-if="isInitial">
                                    Drag a .json file here, or click to browse.
                                </p>
                                <p v-if="isSaving">
                                    Uploading...
                                </p>
                            </div>
                            </form>
                            <div id="json-upload-contents" v-if="isSuccess">
                                
                            </div>
                            <div v-if="isFailed">
                                Failed
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="template-button-import-gtfs">
        <a class="button" @click="$emit('click')">Load from GTFS</a>
    </template>

    <template id="template-button-import-json">
        <a class="button" @click="$emit('click')">Load from JSON</a>
    </template>

    <template id="template-button-basemap-style">
        <div>
            <a class="button multi" @click="setBasemap('Gray')">Light</a>
            <a class="button multi" @click="setBasemap('DarkGray')">Dark</a>
            <a class="button multi" @click="setBasemap('Oceans')">Colorful</a>
            <a class="button multi" @click="setBasemap('Imagery')">Satellite</a>
        </div>
    </template>

    <template id="template-button-basemap-labels">
        <div>
            <a class="button multi" @click="setLabels(true)">On</a>
            <a class="button multi" @click="setLabels(false)">Off</a>
        </div>
    </template>

    <template id="template-button-export-pdf">
        <div>
            <a class="button" @click="exportPdf()">Save as PDF</a>
        </div>
    </template>

    <template id="template-button-export-json">
        <div>
            <a class="button" @click="exportJson()">Save as JSON</a>
        </div>
    </template>

    <template id="template-button-sharing">
        <a id="share" class="button" @click="$emit('click')">Share</a>
    </template>
    <!-- -->

    <div id="app">
        <div id="navbar">
            <div id="nav-enmodal-logo"><img src="static/img/logo.png" /></div>
            <div id="nav-user-logged-in" {% if not current_user.is_authenticated %}style="display:none;" {% endif %}>
                <div><a href="user" id="logged-in-user-email">{{ current_user.email }}</a></div>
                <div><a id="logout" class="button">Logout</a></div>
            </div>
            <div id="nav-user-logged-out" {% if current_user.is_authenticated %}style="display:none;" {% endif %}>
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle dropdown-button" data-toggle="dropdown">Register <span class="caret"></span></button>
                        <ul id="dropdown-register" class="dropdown-menu dropdown-lr animated fadeIn" role="menu">
                            <div class="col-lg-12">
                                <div class="text-center">
                                    <h3><b>Register</b></h3></div>
                                <div id="dropdown-register-fields">
                                    <form id="ajax-register-form" action="#" method="post" role="form" autocomplete="off">
                                        <div class="form-group">
                                            <div id="register-first-name" class="form-group">
                                                <input type="text" name="first_name" id="first_name" tabindex="1" class="form-control" placeholder="First Name">
                                            </div>
                                            <div id="register-last-name" class="form-group">
                                                <input type="text" name="last_name" id="last_name" tabindex="2" class="form-control" placeholder="Last Name">
                                            </div>
                                        </div>
                                        <div id="register-email" class="form-group">
                                            <input type="email" name="email" id="email" tabindex="3" class="form-control" placeholder="Email Address" value="">
                                        </div>
                                        <div id="register-password" class="form-group">
                                            <input type="password" name="password" id="password" tabindex="4" class="form-control" placeholder="Password">
                                        </div>
                                        <div id="register-confirm-password" class="form-group">
                                            <input type="password" name="confirm_password" id="confirm_password" tabindex="5" class="form-control" placeholder="Confirm Password">
                                        </div>
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-xs-6 col-xs-offset-3">
                                                    <button type="button" id="register-submit" tabindex="6" class="form-control btn btn-info">Register</button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div id="dropdown-register-done" class="alert alert-success" role="alert" style="display: none;">
                                    Thanks! You'll receive an email with a link to activate your account.
                                </div>
                                <div id="dropdown-register-problem" class="alert alert-danger" role="alert" style="display: none;">
                                    
                                </div>
                            </div>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle dropdown-button" data-toggle="dropdown">Log In <span class="caret"></span></button>
                        <ul class="dropdown-menu dropdown-lr animated fadeIn" role="menu">
                            <div class="col-lg-12">
                                <div class="text-center">
                                    <h3><b>Log In</b></h3>
                                </div>
                                <form id="ajax-login-form" action="#" method="post" role="form" autocomplete="off">
                                    <div class="form-group">
                                        <label for="email">Email</label>
                                        <input type="email" name="email" id="email" tabindex="1" class="form-control" placeholder="Email address" value="" autocomplete="off">
                                    </div>

                                    <div class="form-group">
                                        <label for="password">Password</label>
                                        <input type="password" name="password" id="password" tabindex="2" class="form-control" placeholder="Password" autocomplete="off">
                                    </div>

                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-xs-7">
                                                <input type="checkbox" tabindex="3" name="remember" id="remember">
                                                <label for="remember"> Remember Me</label>
                                            </div>
                                            <div class="col-xs-5 pull-right">
                                                <button type="button" id="login-submit" tabindex="4" class="form-control btn btn-success">Log In</button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="text-center">
                                                    <a href="#" tabindex="5" class="forgot-password">Forgot Password?</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <div id="login-problem" class="alert alert-danger" role="alert" style="display: none;">
                                    Please check email/password combination and try again.
                                </div>
                                <div id="login-resend-validation" class="alert alert-warning" role="alert" style="display: none;">
                                    You must confirm your email address before logging in.
                                    <button type="button" id="login-resend-validation-button" tabindex="6" class="form-control btn btn-link">Resend confirmation email</button>
                                </div>
                                <div id="login-reset-password" class="alert alert-success" role="alert" style="display: none;">
                                    If there is an account associated with the email address provided, the password has been reset and you will receive an email containing the new password shortly.
                                </div>
                                </form>
                            </div>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        
        {% block body %}{% endblock %}
    
    </div>
    
    <script src="static/js/vue.min.js"></script>
    <script src="//unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
    <script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
    <script src="static/js/enmodal.min.js"></script>
    
    <script>
        (function(i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-98633069-1', 'auto');
        ga('send', 'pageview');
    </script>

</body>

</html>